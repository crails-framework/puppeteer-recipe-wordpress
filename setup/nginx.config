souurce ./variables

php_minor_version=`php --version | head -n 1 | cut -d ' ' -f 2 | cut -d '.' -f 1,2`
fpm_config_file="/etc/php/$php_minor_version/fpm/pool.d/www.conf"
fpm_socket_path=`cat $fpm_config_file | grep -e ".sock$" | cut -d '=' -f 2`

cat << EOF
server {
  listen $APP_PORT;

  root /home/$APP_USER;
  index index.php;
  client_max_body_size 25M;

  location / {
    try_files \$uri \$uri/ /index.php\$args;
  }

  location ~ .php$ {
    fastcgi_pass unix:$fpm_socket_path;
    fastcgi_index index.php;
    include fastcgi.conf;
  }

  location ~* .(js|css|png|jpg|jpeg|gif|ico)$ {
    expires max;
    log_not_found off;
  }
}
EOF
