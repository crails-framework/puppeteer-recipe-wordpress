source ./variables

keys_length=64
charset='a-zA-Z0-9<>_-{}[]()#|~'
auth_key=`        cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
secure_auth_key=` cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
logged_in_key=`   cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
nonce_key=`       cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
auth_salt=`       cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
secure_auth_salt=`cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
logged_in_salt=`  cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`
nonce_salt=`      cat /dev/urandom | tr -dc $charset | fold -w $keys_length | head -n 1`

if [[ -z "$WP_SITEURL" ]] ; then
  export WP_SITEURL="/"
fi

if [[ -z "$APP_SQL_DATABASE" ]] ; then
  export APP_SQL_DATABASE="$INSTANCE_NAME"
fi

if [[ -z "$APP_SQL_USER" ]] ; then
  export APP_SQL_USER="$APP_USER"
fi

if [[ -z "$TABLE_PREFIX" ]] ; then
  export TABLE_PREFIX="wp_"
fi

if [[ -z "$DISABLE_WP_CRON" ]] ; then
  export DISABLE_WP_CRON="false"
fi

cat << EOF
<?php
  /**
   * The base configuration for WordPress
   * This file was generated by Puppeteer's Wordpress Recipe
   */

  // MySQL settings
  define( 'DB_NAME', '$APP_SQL_DATABASE' );

  define( 'DB_USER', '$APP_SQL_USER' );

  define( 'DB_PASSWORD', '$APP_SQL_PASSWORD' );

  define( 'DB_HOST', 'localhost' );

  define( 'DB_CHARSET', 'utf8mb4' );

  define( 'DB_COLLATE', '');

  // URL settigngs
  define( 'WP_HOME',    '$WP_SITEURL');
  define( 'WP_SITEURL', '$WP_SITEURL');

  define( 'UPLOADS', 'uploads' );

  // Authentication unique keys and salt
  define( 'AUTH_KEY',         '$auth_salt' );
  define( 'SECURE_AUTH_KEY',  '$secure_auth_key' );
  define( 'LOGGED_IN_KEY',    '$logged_in_key' );
  define( 'NONCE_KEY',        '$nonce_key' );
  define( 'AUTH_SALT',        '$auth_salt' );
  define( 'SECURE_AUTH_SALT', '$secure_auth_salt' );
  define( 'LOGGED_IN_SALT',   '$logged_in_salt' );
  define( 'NONCE_SALT',       '$nonce_salt' );

  \$table_prefix = '$TABLE_PREFIX';

  define( 'DISABLE_WP_CRON', $DISABLE_WP_CRON );

  define( 'WP_DEBUG', false );

  /**
   * END Wordpress Settings
   */

  if ( ! defined( 'ABSPATH' ) ) {
    define( 'ABSPATH', dirname( __FILE__ ) . '/' );
  }

  require_once( ABSPATH . 'wp-settings.php' );
?>
EOF
